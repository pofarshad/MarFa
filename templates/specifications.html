<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specifications - MarFaNet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-mobile-alt me-2"></i>
                MarFaNet Refactoring Dashboard
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Dashboard</a>
                <a class="nav-link" href="/analysis">Analysis</a>
                <a class="nav-link active" href="/specifications">Specifications</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Specifications Overview -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="fas fa-file-code me-2"></i>
                            Technical Specifications
                        </h4>
                    </div>
                    <div class="card-body">
                        <p class="lead">
                            Generated specifications for MarFaNet transformation
                        </p>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h5 class="text-primary">Xray Integration</h5>
                                    <i class="fas fa-exchange-alt fa-3x text-primary mb-2"></i>
                                    <p>Core replacement specifications</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h5 class="text-success">Rebranding</h5>
                                    <i class="fas fa-paint-brush fa-3x text-success mb-2"></i>
                                    <p>MarFaNet branding guidelines</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h5 class="text-info">GFW Knocker</h5>
                                    <i class="fas fa-shield-alt fa-3x text-info mb-2"></i>
                                    <p>Integration specifications</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Specification Cards -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-exchange-alt me-2"></i>Xray Core Integration</h5>
                    </div>
                    <div class="card-body">
                        <h6>Dependencies to Remove:</h6>
                        <ul class="list-unstyled">
                            <li><code class="text-danger">io.github.sagernet:sing-box-core</code></li>
                            <li><code class="text-danger">io.github.sagernet:sing-box-jni</code></li>
                            <li><code class="text-danger">io.github.sagernet:libbox-jni</code></li>
                        </ul>
                        
                        <h6>Dependencies to Add:</h6>
                        <ul class="list-unstyled">
                            <li><code class="text-success">com.github.2dust:xray-core:latest.release</code></li>
                        </ul>
                        
                        <h6>Native Libraries:</h6>
                        <div class="alert alert-info">
                            <strong>Required native library structure:</strong>
                            <pre class="mt-2 mb-0"><code>src/main/jniLibs/
├── arm64-v8a/
│   └── libxray.so
├── armeabi-v7a/
│   └── libxray.so
└── x86_64/
    └── libxray.so</code></pre>
                        </div>
                        
                        <button class="btn btn-primary" onclick="generateXraySpecs()">
                            <i class="fas fa-file-code me-2"></i>Generate Full Specs
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-paint-brush me-2"></i>Rebranding Specifications</h5>
                    </div>
                    <div class="card-body">
                        <h6>Application ID:</h6>
                        <p><code>net.marfanet.android</code></p>
                        
                        <h6>App Name Changes:</h6>
                        <ul>
                            <li>Hiddify → MarFaNet</li>
                            <li>HiddifyNG → MarFaNet</li>
                            <li>com.hiddify.* → net.marfanet.*</li>
                        </ul>
                        
                        <h6>Resources to Update:</h6>
                        <ul>
                            <li>App name strings</li>
                            <li>Launcher icons</li>
                            <li>Splash screen</li>
                            <li>About page</li>
                        </ul>
                        
                        <h6>Icon Specification:</h6>
                        <div class="alert alert-warning">
                            <strong>Required icon sizes:</strong>
                            <ul class="mb-0">
                                <li>mdpi: 48x48px</li>
                                <li>hdpi: 72x72px</li>
                                <li>xhdpi: 96x96px</li>
                                <li>xxhdpi: 144x144px</li>
                                <li>xxxhdpi: 192x192px</li>
                            </ul>
                        </div>
                        
                        <button class="btn btn-success" onclick="generateRebrandingSpecs()">
                            <i class="fas fa-palette me-2"></i>Generate Rebranding Guide
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- GFW Knocker Integration -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-shield-alt me-2"></i>GFW Knocker Integration</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Kotlin Module Structure:</h6>
                                <pre class="bg-light p-3"><code>gfwknocker/
├── src/main/kotlin/
│   └── net/marfanet/gfwknocker/
│       ├── Knocker.kt
│       ├── KnockerConfig.kt
│       └── KnockerService.kt
└── src/main/jniLibs/
    ├── arm64-v8a/libgfwknocker.so
    ├── armeabi-v7a/libgfwknocker.so
    └── x86_64/libgfwknocker.so</code></pre>
                            </div>
                            <div class="col-md-6">
                                <h6>API Interface:</h6>
                                <pre class="bg-light p-3"><code>class Knocker {
    companion object {
        fun start(config: KnockerConfig): Boolean
        fun stop(): Boolean
        fun isRunning(): Boolean
        fun getStatus(): KnockerStatus
    }
}</code></pre>
                                
                                <h6>Integration Points:</h6>
                                <ul>
                                    <li>VPN service auto-start</li>
                                    <li>Configuration UI</li>
                                    <li>Status monitoring</li>
                                </ul>
                            </div>
                        </div>
                        <button class="btn btn-info" onclick="generateGfwKnockerSpecs()">
                            <i class="fas fa-shield-alt me-2"></i>Generate GFW Knocker Specs
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gradle Configuration -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cog me-2"></i>Gradle Configuration Updates</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>build.gradle (app) Changes:</h6>
                                <pre class="bg-light p-3"><code>android {
    compileSdk 34
    defaultConfig {
        applicationId "net.marfanet.android"
        minSdk 21
        targetSdk 34
        versionCode 1
        versionName "1.0.0"
    }
    
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    
    kotlinOptions {
        jvmTarget = '1.8'
    }
}</code></pre>
                            </div>
                            <div class="col-md-6">
                                <h6>Dependencies Updates:</h6>
                                <pre class="bg-light p-3"><code>dependencies {
    // Remove Sing-box
    // implementation 'io.github.sagernet:sing-box-core:1.8.0'
    
    // Add Xray core
    providedRuntime 'com.github.2dust:xray-core:latest.release'
    
    // GFW Knocker module
    implementation project(':gfwknocker')
    
    // WorkManager for rule updates
    implementation 'androidx.work:work-runtime-ktx:2.8.1'
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Panel -->
        <div class="row">
            <div class="col-12 text-center">
                <button class="btn btn-primary me-3" onclick="generateAllSpecs()">
                    <i class="fas fa-cogs me-2"></i>Generate All Specifications
                </button>
                <button class="btn btn-success me-3" onclick="validateSpecs()">
                    <i class="fas fa-check me-2"></i>Validate Specifications
                </button>
                <button class="btn btn-info" onclick="downloadSpecsPackage()">
                    <i class="fas fa-download me-2"></i>Download Complete Package
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        function generateXraySpecs() {
            showLoadingMessage('Generating Xray integration specifications...');
            
            fetch('/api/generate-xray-specs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    analysis_data: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoadingMessage();
                if (data.success) {
                    showSuccessMessage('Xray specifications generated successfully!');
                } else {
                    showErrorMessage('Failed to generate specifications: ' + data.error);
                }
            })
            .catch(error => {
                hideLoadingMessage();
                showErrorMessage('Error: ' + error.message);
            });
        }

        function generateRebrandingSpecs() {
            showLoadingMessage('Generating rebranding specifications...');
            
            fetch('/api/generate-rebranding-specs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    current_config: {}
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoadingMessage();
                if (data.success) {
                    showSuccessMessage('Rebranding specifications generated successfully!');
                } else {
                    showErrorMessage('Failed to generate specifications: ' + data.error);
                }
            })
            .catch(error => {
                hideLoadingMessage();
                showErrorMessage('Error: ' + error.message);
            });
        }

        function generateGfwKnockerSpecs() {
            showLoadingMessage('Generating GFW Knocker specifications...');
            
            // Simulate API call
            setTimeout(() => {
                hideLoadingMessage();
                showSuccessMessage('GFW Knocker specifications generated successfully!');
            }, 2000);
        }

        function generateAllSpecs() {
            showLoadingMessage('Generating all specifications...');
            
            Promise.all([
                fetch('/api/generate-xray-specs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ analysis_data: {} })
                }),
                fetch('/api/generate-rebranding-specs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ current_config: {} })
                })
            ])
            .then(responses => Promise.all(responses.map(r => r.json())))
            .then(results => {
                hideLoadingMessage();
                const allSuccess = results.every(r => r.success);
                if (allSuccess) {
                    showSuccessMessage('All specifications generated successfully!');
                } else {
                    showErrorMessage('Some specifications failed to generate');
                }
            })
            .catch(error => {
                hideLoadingMessage();
                showErrorMessage('Error: ' + error.message);
            });
        }

        function validateSpecs() {
            showLoadingMessage('Validating specifications...');
            
            // Simulate validation
            setTimeout(() => {
                hideLoadingMessage();
                showSuccessMessage('All specifications validated successfully!');
            }, 3000);
        }

        function downloadSpecsPackage() {
            window.location.href = '/api/download-specs';
        }
    </script>
</body>
</html>
