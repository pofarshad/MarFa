# **MarFaNet Project â€“ Phaseâ€¯2 Validation & Phaseâ€¯3 Kickâ€‘off**

---

## 1â€¯â€¢â€¯Phaseâ€¯2 Validation Checklist

| Requirement                               | Status        | Remaining Action                                                                                                                         |
| ----------------------------------------- | ------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| **GFWâ€‘Knocker JNI Stub + Kotlin Wrapper** | âœ… Implemented | â€¢â€¯Merge into `milestone2/gfw-knocker` branch.<br>â€¢â€¯Add `NativeBridge.reloadKnockerConfig()` hook when native shared libs present.        |
| **Knocker Config & Monitoring**           | âœ… Implemented | â€¢â€¯Expose runtime metrics in `KnockerStatus`. Unitâ€‘test getters.                                                                          |
| **Routing Autoâ€‘Update Worker**            | âœ… Implemented | â€¢â€¯Wire to `WorkManagerInitializer`; ensure periodic policy respects Doze.<br>â€¢â€¯Mock Xray reload in unit tests.                           |
| **CIâ€‘ready Logging & Progress Tracking**  | âœ… Implemented | â€”                                                                                                                                        |
| **Unitâ€‘test Coverage â‰¥â€¯90â€¯%**             | â¬œ Pending     | **Action:** write tests for `Knocker.kt`, `RoutingRulesUpdateWorker.kt`, `ChecksumUtil.kt`.                                              |
| **Settingsâ€‘UI Toggle for Knocker**        | â¬œ Pending     | **Action:** add `SwitchPreferenceCompat` in *Settings â†’ Advanced*; bind to `SharedPrefs` and runtime enable/disable.                     |
| **jniLibs Placeholders & README**         | â¬œ Pending     | **Action:** create `src/main/jniLibs/{armeabi-v7a,arm64-v8a,x86_64}/README.md` describing how to drop `libxray.so` & `libgfwknocker.so`. |
| **Branch & PR Workflow**                  | â¬œ Pending     | **Action:** push commits to `milestone2/gfw-knocker`; open PR to `develop`; link to dashboard SHAs.                                      |

### Phaseâ€‘2 Exit Criteria

1. `./gradlew lint detekt ktlintCheck testDebugUnitTest` â†’ **0 exit code**.
2. JaCoCo report shows **â‰¥â€¯90â€¯% coverage** for new modules.
3. Dashboard autoâ€‘updates progress bars via Git webhooks.

---

## 2â€¯â€¢â€¯Immediate Tasks (Today)

1. **Unit Tests**

   ```bash
   ./gradlew testDebugUnitTest jacocoTestReport
   ```

   â€¢â€¯Use Robolectric for Worker testing.
   â€¢â€¯Mock `URL` download with OkHttp MockWebServer.
2. **UI Integration**
   *File:* `ui/settings/AdvancedSettingsFragment.kt`

   ```kotlin
   preference("pref_gfw_knocker") {
       title = R.string.pref_gfw_knocker
       summary = R.string.pref_gfw_knocker_sum
       switchBinding("enable_gfw_knocker", default = true)
   }
   ```
3. **jniLibs Structure**

   ```text
   app/src/main/jniLibs/
   â”œâ”€â”€ arm64-v8a/README.md
   â”œâ”€â”€ armeabi-v7a/README.md
   â””â”€â”€ x86_64/README.md
   ```

   Each README: *â€œPlace libxray.so and libgfwknocker.so here before building Release.â€*
4. **Commit & Push**
   *Message example:* `feat(knocker): add JNI stub and config (#7)`

---

## 3â€¯â€¢â€¯Phaseâ€¯3 â€“ Performance & Stability (Kickâ€‘off When Phaseâ€¯2 = Done)

| Task                       | Owner   | Tooling                                    | Acceptance                                    |
| -------------------------- | ------- | ------------------------------------------ | --------------------------------------------- |
| **Benchmark Harness**      | Core    | Android Macrobenchmark; Pixelâ€¯6 + Emulator | Coldâ€‘start â‰¤â€¯1.2â€¯s.<br>CPU & RAM âˆ’â€¯15â€¯%.      |
| **Connection Stressâ€‘Test** | Network | Shell script + `adb` instrumentation       | 24â€¯h run with â‰¤â€¯1 error reconnect.            |
| **Memory Leak Detection**  | Core    | LeakCanary (debug)                         | Zero retained objects >â€¯512â€¯KB after 30â€¯min.  |
| **Profiling & Report**     | Perf    | Android Studio Profiler â†’ `PERF_REPORT.md` | Log before/after metrics; attach flamegraphs. |

### Timeline (calendar days)

| Day  | Activity                                             |
| ---- | ---------------------------------------------------- |
| +0   | Finalise Phaseâ€¯2 PR merge, Tag `milestone2-complete` |
| +1â€‘2 | Build Macrobenchmark & stressâ€‘test scripts           |
| +3â€‘6 | Optimise code paths, measure, iterate                |
| +7   | Draft **PERF\_REPORT.md** & update dashboard         |

---

## 4â€¯â€¢â€¯CI/CD Preparations (Preview)

1. **GitHub Action** â€“ job `detekt â†’ lint â†’ test â†’ jacoco â†’ buildDebug`.
2. **Artifact Upload** â€“ attach `lint-results.html`, `jacoco.xml`.
3. **Codecov** â€“ enforce â‰¥â€¯80â€¯% overall.

*CI tasks will formally begin in Milestoneâ€¯4 once performance targets met.*

---

## 5â€¯â€¢â€¯Next Checkâ€‘in

> ğŸš€ **After completing Unit Tests, UI toggle, and jniLibs placeholders, push to `milestone2/gfw-knocker` and post CI output here for review.**

---

**End of Document**
