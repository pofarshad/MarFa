# **CI Failure Triage â€“ 23â€¯Mayâ€¯2025**

> *Scope:* 16 sequential GitHub Actions runs on `main` failed while integrating Splitâ€‘Tunnelling, WireGuard benchmarks, Stats Overlay, and AutoFixBot. This doc aggregates common rootâ€‘causes, maps them to failing steps, and proposes targeted fixes.

---

## 1 â€¢ Failure Pattern Snapshot

| BuildÂ ID  | Workflow           | Step (failing)                               | Symptom                                              | Likely Cause                                         |
| --------- | ------------------ | -------------------------------------------- | ---------------------------------------------------- | ---------------------------------------------------- |
| #22Â â†’Â #8  | **CI/CD Pipeline** | `Run Security Scan (dependencyCheckAnalyze)` | `./gradlew: No such file or directory`               | Wrong workingâ€‘directory after moving modules         |
| #13Â â†’Â #11 | **Build APK**      | `Gradle Build`                               | `Task :bench_wg FAILED` (exitÂ 1)                     | Benchmark script referencing missing `iperf3` binary |
| #9        | **Fixed Pipeline** | `Upload artefact`                            | `Missing upload-info for actions/upload-artifact@v3` | One workflow still uses v3 (needs v4)                |
| #7Â â†’Â #4   | **CI/CD Pipeline** | `Lint`                                       | `androidx.compose.* not found`                       | Compose 2.0 dependencies not synced to AGPÂ 9 repo    |
| #3Â â†’Â #1   | **Fixed Pipeline** | `Setup Android`                              | License failure (`sdkmanager --licenses`)            | Missing `android-34` license agreement               |

---

## 2 â€¢ Immediate Hotâ€‘Fix Tasks

| ID                                           | Fix                                    | Change                                                                                     | Priority |
| -------------------------------------------- | -------------------------------------- | ------------------------------------------------------------------------------------------ | -------- |
| Fâ€‘01                                         | **Ensure correct workingâ€‘dir**         | Add `working-directory: ./android` to every `run:` step or move wrapper back to repo root. | ðŸ”´ P0    |
| Fâ€‘02                                         | **Update remaining `upload-artifact`** | Replace `@v3` with `@v4` in `ci_fixed.yml`.                                                | ðŸ”´ P0    |
| Fâ€‘03                                         | **Embed iperf3 binary**                | Add `tools/iperf3/iperf3-static` to repo & reference via `${{ github.workspace }}`.        | ðŸŸ  P1    |
| Fâ€‘04                                         | **Sync ComposeÂ 2.0 Maven repos**       | Add `maven("https://androidx.dev/storage/compose2/repository")` in `settings.gradle`.      | ðŸŸ  P1    |
| Fâ€‘05                                         | **Accept SDKÂ 34 licenses in CI**       | Add \`sdkmanager --licenses <\<EOF                                                         |          |
| y                                            |                                        |                                                                                            |          |
| y                                            |                                        |                                                                                            |          |
| EOF`step in`android-actions/setup-android\`. | ðŸŸ¡ P2                                  |                                                                                            |          |

---

## 3 â€¢ Workflow Guardrails (Prevent Regression)

1. **Matrix Smoke Job** â€“ lightweight `./gradlew help` run on PR open; fails fast if wrapper path breaks.
2. **Action Version Pinning** â€“ Use exact SHAs for `upload-artifact`, `checkout`, `setup-java`.
3. **CI Docs Lint** â€“ Auto check for deprecated actions via Renovate bot.
4. **Failâ€‘fast on Missing Artefact** â€“ Add `continue-on-error: false` to uploadâ€‘artifact step.

---

## 4 â€¢ Next Steps Workflow

1. **Commit Hotâ€‘Fixes Fâ€‘01 & Fâ€‘02** â†’ Push `ci/hotfix-wrapper-artifact` branch.
2. **Reâ€‘run failed workflow**; confirm Gradle wrapper executes and artefacts upload.
3. Apply Fâ€‘03 (iperf3) in separate PR; test benchmark step locally (`./gradlew bench_wg`).
4. Sync ComposeÂ 2.0 repo (Fâ€‘04) and accept licenses (Fâ€‘05) in same PR.
5. Once CI green, tag `v1.1.0-alpha1` again (`-alpha1b`) if artefact was not generated.

---

## 5 â€¢ AutoFixBot Enhancement

* Add rule to ignore wrapper path errors by suggesting `working-directory` correction.
* Extend prompt to capture missing action versions and replace with latest.

---

**Owner Assignments**

* Pofarshad â€“ Fâ€‘01, Fâ€‘02
* Net Dev â€“ Fâ€‘03
* UI Dev â€“ Fâ€‘04
* DevOps â€“ Fâ€‘05

*Target completion: next business day.*
